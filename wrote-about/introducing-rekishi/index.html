<!DOCTYPE html><html class="no-js" lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><title>Introducing Rekishi - Robb Owen</title><meta name="description" content="Becoming frustrated with gaps in the history api, I built Rekishi, a minimal pubsub wrapper to watch for URL changes."><meta name="theme-color" content="#cabec6"><meta name="color-scheme" content="only light"><link rel="apple-touch-icon" sizes="180x180" href="../../assets/img/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../../assets/img/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../../assets/img/favicon-16x16.png"><link rel="icon" type="image/png" href="../../assets/img/favicon.ico"><link href="https://front-end.social/@robb" rel="me"><meta property="og:site_name" content="Robb Owen Digital"><meta property="og:type" content="website"><meta property="og:locale" content="en_gb"><meta property="og:url" content="https://robbowen.digital/wrote-about/introducing-rekishi/"><meta property="og:title" content="Introducing Rekishi - Robb Owen "><meta property="og:description" content="Becoming frustrated with gaps in the history api, I built Rekishi, a minimal pubsub wrapper to watch for URL changes."><meta property="og:image" content="https://robbowen.digital/assets/img/cards/introducing-rekishi.png"><meta name="twitter:image" content="https://robbowen.digital/assets/img/cards/introducing-rekishi.png"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@Robb0wen"><link href="../../feed.xml" rel="alternate" type="application/rss+xml" title="RSS Feed"><script>document.querySelector('html').classList.add('js');
    document.querySelector('html').classList.remove('no-js');</script><link href="https://fonts.googleapis.com/css?family=Bitter:400,700&amp;display=swap" rel="stylesheet"><link rel="stylesheet" href="../../assets/css/styles.css"><style id="theme">:root{--bg:#f5f5f5;--line:#554550;--fill:#cabec6;--text:#554550;--subtext:#554550;--duo:#cabec6}.stripes{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 22.93 22.93'%3E%3Cpolygon fill='%23cabec6' points='0 8.18 14.75 22.93 22.74 22.93 0 0.19 0 8.18'/%3E%3Cpolygon fill='%23cabec6' points='22.93 8.37 22.93 0.38 22.56 0 14.56 0 22.93 8.37'/%3E%3C/svg%3E");background-size:11px;opacity:.6}.dots{background-image:url("data:image/svg+xml,%3Csvg version='1.1' id='Layer_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 22.9 22.9' style='enable-background:new 0 0 22.9 22.9;' xml:space='preserve'%3E%3Ccircle fill='%23cabec6' class='st0' cx='5.7' cy='5.9' r='3'/%3E%3Ccircle fill='%23cabec6' class='st0' cx='17.2' cy='17.2' r='3'/%3E%3C/svg%3E%0A");background-size:12px}</style></head><body><a class="skip-link u-vhide" href="index.html#main-content">Skip to content</a><div class="loading loading--in"><div class="loading__mask"></div><div class="loader"><div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div></div></div><div class="pagewrap"><div class="mainnav"><div class="logo-wrap"><a href="../../index.html"><span class="u-vhide">Back to the homepage</span> <span class="logo js-logo"><div class="logo__sugarloaf"><div class="shade" data-drift="-5 -10"><svg version="1.1" x="0px" y="0px" viewBox="0 0 256 256"><polygon class="filled-poly" points="137.6,67.7 38.5,193 236.8,193 "></polygon></svg></div><div class="logo"><svg version="1.1" x="0px" y="0px" viewBox="0 0 256 256"><polygon class="stroke-poly" points="105.2,79.7 28.2,177 182.2,177 "></polygon><polygon class="stroke-poly" points="127.6,51.7 28.5,177 226.8,177 "></polygon></svg></div></div></span></a></div><div class="menu-link"><button class="menu-link__trigger js-menu-trigger" aria-expanded="false" aria-controls="main-menu"><span class="menu-link__mask"><span class="menu-link__label menu-link__label--close js-menu-label-close" aria-hidden="true">Close</span> <span class="menu-link__label menu-link__label--open js-menu-label-open" aria-hidden="false">Menu</span></span></button></div><a class="hire-me" href="mailto:hello@robbowen.digital?subject=ðŸ¤˜ Hi Robb, I'd like to hire you"><div class="shade" data-drift="-4 -6" data-drift-center="y"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 60"><path class="filled-path" d="M30.78,9.87c13.52,0,24.46,9.58,24.46,21.41a19.4,19.4,0,0,1-5,12.95h0l2.9,9.82L42.37,50.1h0a27.51,27.51,0,0,1-11.59,2.58,26.84,26.84,0,0,1-14-3.86C10.42,45,6.24,38.52,6.24,31.2,6.24,19.53,17.26,9.87,30.78,9.87Z"></path></svg></div><div class="main"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 60"><path class="stroke-path" d="M27.78,5.87c13.52,0,24.46,9.58,24.46,21.41a19.4,19.4,0,0,1-5,12.95h0l2.9,9.82L39.37,46.1h0a27.51,27.51,0,0,1-11.59,2.58,26.84,26.84,0,0,1-14-3.86C7.42,41,3.24,34.52,3.24,27.2,3.24,15.53,14.26,5.87,27.78,5.87Z"></path></svg></div>Hire me</a></div><div class="main-menu js-menu" id="main-menu"><div class="main-menu__mask"></div><div class="main-menu__flyout"><div class="main-menu__inr wrap"><ul class="social-links"><li class="social-links__item"><a class="social-links__link social-links__link--ma" href="https://front-end.social/@Robb" rel="noopener noreferrer" target="_blank">Follow me on Mastodon</a></li><li class="social-links__item"><a class="social-links__link social-links__link--in" href="http://www.instagram.com/robb0wen" rel="noopener noreferrer" target="_blank">Follow me on Instagram</a></li><li class="social-links__item"><a class="social-links__link social-links__link--gh" href="https://github.com/robb0wen" rel="noopener noreferrer" target="_blank">Visit my GitHub</a></li><li class="social-links__item"><a class="social-links__link social-links__link--rss" href="../../feed.xml" rel="noopener noreferrer" target="_blank" data-rekishi-skip="">Subscribe to my RSS feed</a></li><li class="social-links__item"><a class="social-links__link social-links__link--email" href="mailto:hello@robbowen.digital" rel="noopener noreferrer" target="_blank">Send me an Email</a></li></ul><ul class="main-menu__links primary-links"><li class="primary-links__item"><a aria-current="page" class="primary-links__link t-primary" href="../../index.html" aria-describedby="desc_home">Home</a> <span id="desc_home" class="primary-links__summary">Back to the home page.</span></li><li class="primary-links__item"><a aria-current="page" class="primary-links__link t-primary" href="../../work" aria-describedby="desc_work">Work</a> <span id="desc_work" class="primary-links__summary">My approach to development.</span></li><li class="primary-links__item"><a class="primary-links__link t-primary" href="../../about" aria-describedby="desc_about">About</a> <span id="desc_about" class="primary-links__summary">A little about me and my background.</span></li><li class="primary-links__item"><a class="primary-links__link t-primary" href="../../writing" aria-describedby="desc_writing">Writing</a> <span id="desc_writing" class="primary-links__summary">My latest writing on tech and language.</span></li></ul></div></div></div><main id="main-content" class="page-body" tabindex="-1"><svg style="position:absolute;top:-900px;left:-900px;clip:rect(0,0,0,0)"><filter id="duotone_filter"><feColorMatrix type="matrix" result="grayscale" values="1 0 0 0 0
                  1 0 0 0 0
                  1 0 0 0 0
                  0 0 0 1 0"></feColorMatrix><feComponentTransfer color-interpolation-filters="sRGB" result="duotone"><feFuncR type="table" tableValues="0.23137254901960785 0.8941176470588236"></feFuncR><feFuncG type="table" tableValues="0.15294117647058825 0.8352941176470589"></feFuncG><feFuncB type="table" tableValues="0.20392156862745098 0.8745098039215686"></feFuncB><feFuncA type="table" tableValues="0 1"></feFuncA></feComponentTransfer></filter></svg><div class="article" data-reveal="is-onscreen"><div><div class="article-heading"><span class="article-heading__byline">26th May 2020</span><h1 class="article-heading__title t-heading t-medium:s t-big:m t-bigger:l"><span>Introducing Rekishi<span class="dot">.</span></span></h1></div></div><div class="article__content flow reveal-content"><div class="break-out"><div class="reveal-img dots" data-src="/assets/img/articles/rekishi-banner.jpg" style="padding-top:26.595744680851062%"><img class="" src="../../assets/img/articles/rekishi-banner.jpg" alt="Rekishi"></div></div><p>Imagine that you're building a website and you need all links to a particular type of content to open in a modal. On top of that, you would also like a nice transition animation to play whenever the user moves in and out of that content type.</p><p>Working with a framework like React or Vue, there are a number of clientside routers and components available to help transition between different pages of content. However, whilst I'm a fan of frontend frameworks, I'm a big believer in incremental development. Instead of reaching straight for a framework, I tend to approach each project from a user-centric path of using the minimum-possible JS, only adding dependencies as I need them.</p><p>If you're working closer-to-the-metal with Vanilla JS, coordinating the above example can be ...tricky. In order to capture and handle URLs as a user moves around the site, you need to use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/History" target="_blank">History API</a>.</p><p>In a nutshell, the history API lets you capture each URL change, and listen to 'pop' events that fire whenever the user navigates forwards or backwards through history. You are also able to associate a particular 'state' with each change. However, there's a frustration that comes with this. When a 'pop' event is fired the URL has <em>already changed</em> and you no longer have any access the outgoing route, or the state object associated with it.</p><p>If you're stringing different types of content together with page transitions, this can make it particularly tricky to choreograph everything. It's precisely this frustration that led me to build <a href="https://github.com/robb0wen/rekishi" target="_blank">Rekishi</a> - a minimal pubsub wrapper for the history API.</p><h2 class="t-heading t-lede:s t-medium:m t-medium:l" id="wrapping-the-api">Wrapping the API<span class="dot">.</span><a href="index.html#wrapping-the-api" class="u-vhide"> permalink</a></h2><p>Rekishi, like my <a href="https://tornis.robbowen.digital" target="_blank">Tornis</a> library before it, uses a pubsub pattern to listen to any changes in URL. This means that you can <a href="https://github.com/robb0wen/rekishi#handler-functions" target="_blank">'subscribe' handler functions to Rekishi</a>. Whenever you push, pop or otherwise change the browser's URL, each of those subscribed functions will fire automatically.</p><p>The key difference with the standard history API though, is that each of those subscribed functions will have access to an object containing information about both the incoming <em>and</em> outgoing route. That object looks a little like this:</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">  incoming<span class="token punctuation">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    path<span class="token punctuation">:</span> String<span class="token punctuation">,</span></span><br><span class="highlight-line">    hash<span class="token punctuation">:</span> String<span class="token punctuation">,</span></span><br><span class="highlight-line">    params<span class="token punctuation">:</span> Object<span class="token punctuation">,</span></span><br><span class="highlight-line">    data<span class="token punctuation">:</span> Object</span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  outgoing<span class="token punctuation">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    path<span class="token punctuation">:</span> String<span class="token punctuation">,</span></span><br><span class="highlight-line">    hash<span class="token punctuation">:</span> String<span class="token punctuation">,</span></span><br><span class="highlight-line">    params<span class="token punctuation">:</span> Object<span class="token punctuation">,</span></span><br><span class="highlight-line">    data<span class="token punctuation">:</span> Object</span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  action<span class="token punctuation">:</span> <span class="token constant">REKISHI_PUSH</span> <span class="token operator">||</span> </span><br><span class="highlight-line">          <span class="token constant">REKISHI_POP</span> <span class="token operator">||</span> </span><br><span class="highlight-line">          <span class="token constant">REKISHI__HASH</span> <span class="token operator">||</span> </span><br><span class="highlight-line">          <span class="token constant">REKISHI_PARAMS</span> <span class="token operator">||</span> </span><br><span class="highlight-line">          <span class="token constant">REKISHI_HASHPARAMS</span> <span class="token operator">||</span> </span><br><span class="highlight-line">          <span class="token constant">REKISHI_NOCHANGE</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>You might also have noticed that this object contains an 'action' property. This property contains a record of the type of URL change that has occurred. This could have been a change in hash fragment, an update to the query string, or whether the user has clicked a new link or travelled backwards through history.</p><p>Similarly, both the incoming and outgoing routes can also have an associated data object. This functions a little bit like the History API's state object, however knowing both <em>incoming and outgoing information</em> allows you to compare and respond accordingly.</p><p>In isolation, actions and data information are useful, but in combination they provide a powerful means of choreographing content changes - Returning to our initial problem of transitioning between a modal and a page, Rekishi would allow you to handle that scenario as follows:</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token keyword">const</span> <span class="token function-variable function">handleRouteChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> incoming<span class="token punctuation">,</span> outgoing<span class="token punctuation">,</span> action <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token comment">// on either history, or new link events...</span></span><br><span class="highlight-line">    <span class="token keyword">case</span> <span class="token constant">REKISHI_POP</span><span class="token punctuation">:</span></span><br><span class="highlight-line">    <span class="token keyword">case</span> <span class="token constant">REKISHI_PUSH</span><span class="token punctuation">:</span></span><br><span class="highlight-line">      </span><br><span class="highlight-line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>incoming<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">'modal'</span> <span class="token operator">&amp;&amp;</span> outgoing<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">'page'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token comment">// AJAX the content from incoming.path</span></span><br><span class="highlight-line">        <span class="token comment">// set up your modal and inject AJAX content</span></span><br><span class="highlight-line">      <span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>incoming<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">'page'</span> <span class="token operator">&amp;&amp;</span> outgoing<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">'modal'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token comment">//close your modal and remove the content</span></span><br><span class="highlight-line">      <span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">      <span class="token keyword">break</span><span class="token punctuation">;</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></pre><h2 class="t-heading t-lede:s t-medium:m t-medium:l" id="associating-path-data">Associating path data<span class="dot">.</span><a href="index.html#associating-path-data" class="u-vhide"> permalink</a></h2><p>Aside from handling URL changes, there's another reason that clientside frameworks like React make page transitions easier. Because they take the rendering of content away from the server entirely, they have access to information about each route ahead-of-time. When building an application with the History API and server-side routing, this approach isn't available to us.</p><p>Rekishi also provides a means of bridging the two approaches. When initialising Rekishi, it's possible to <a href="https://github.com/robb0wen/rekishi#registeredpaths" target="_blank">pass an array of URL matchers</a> that can associate default data with a particular path. This means that your app will know what data might be coming from a particular URL, before it is hit:</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token punctuation">[</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    path<span class="token punctuation">:</span> <span class="token string">'/posts/*'</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    data<span class="token punctuation">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">      type<span class="token punctuation">:</span> <span class="token string">'post'</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    path<span class="token punctuation">:</span> <span class="token string">'/posts/riding-the-shinkansen'</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    data<span class="token punctuation">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">      type<span class="token punctuation">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      featured<span class="token punctuation">:</span> <span class="token boolean">true</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">]</span></span></code></pre><h2 class="t-heading t-lede:s t-medium:m t-medium:l" id="putting-it-to-the-test">Putting it to the test<span class="dot">.</span><a href="index.html#putting-it-to-the-test" class="u-vhide"> permalink</a></h2><p>To put Rekishi to the test, I decided to refactor this website to use it instead of the (still very useful) <a href="https://github.com/ReactTraining/history" target="_blank">history module</a>. Rekishi is small library (less than 2k when gzipped) and in making the switch I have managed to reduce my JS bundle size by a total of around 4kb. In isolation that figure might not seem much, but it made up roughly 23% of the pre-Rekishi bundle size of approximately 17kb. Not too shabby.</p><h2 class="t-heading t-lede:s t-medium:m t-medium:l" id="wrapping-up">Wrapping up<span class="dot">.</span><a href="index.html#wrapping-up" class="u-vhide"> permalink</a></h2><p>All-in-all, I've found that using Rekishi has greatly sped up my workflow for building vanilla JS websites. Using it in conjunction with <a href="https://tornis.robbowen.digital" target="_blank">Tornis</a> to handle interactions, I'm finding that I'm needing to rely less and less on frameworks in my day-to-day website builds. In terms of my end-user's bandwidth, I consider that a very good thing.</p><p>I'm hoping that others will find it useful, so I've released Rekishi as an open-source project. The <a href="https://github.com/robb0wen/rekishi" target="_blank">source and documentation is available on GitHub</a>. It is also available to install as a clientside dependency from <a href="https://www.npmjs.com/package/rekishi" target="_blank">npm</a>.</p></div><footer class="article__footer"><div class="author"><div class="author__inr"><div class="author__portrait"><div class="portrait"><span class="portrait__bg dots" data-drift="-10 -10"></span><div class="portrait__image"><span class="duotone"><img src="../../assets/img/portrait_small.jpg"></span></div></div></div><div class="author__bio flow"><h4 class="t-heading t-sublede:s t-lede:m t-medium:l">Hi, my name is Robb<span class="dot">.</span></h4><p>I'm a freelance creative developer helping awesome people to build ambitious yet accessible web projects.</p><a href="mailto:hello@robbowen.digital?subject=ðŸ¤˜ Hi Robb, I'd like to hire you" class="btn author__cta"><span class="btn__label">Hire me</span> <span class="btn__fill stripes" data-drift="-10 -12" aria-hidden="true">Hire me</span></a></div></div></div></footer></div></main><small class="made-in-wales">Â© MMXXIV. Gwneud yn Ne Cymru.</small></div><script src="../../assets/js/main.js"></script></body></html>